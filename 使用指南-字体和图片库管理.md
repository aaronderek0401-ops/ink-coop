python tools/ttf_to_gfx_webservice.py# 字体和图片库管理功能使用指南

## 🎯 功能概述

新增了字体库和图片库管理功能，可以方便地管理、预览和导入字体及图片位图文件。

## 📋 功能列表

### 1. 字体库管理（TTF 字体管理部分）
- ✅ 查询 `components/fonts` 文件夹下的所有字体文件
- ✅ 显示字体文件名和大小
- ✅ 一键导入字体到程序
- ✅ 自动复制 include 路径到剪贴板

### 2. 图片库管理（图片转位图部分）
- ✅ 保存位图到 `components/bitmap` 文件夹
- ✅ 查询所有已保存的位图文件
- ✅ 预览位图效果（黑白显示）
- ✅ 显示位图尺寸和文件大小
- ✅ 一键导入位图到程序

## 🚀 使用步骤

### 启动服务

1. 打开终端，进入项目根目录
2. 运行命令：
```bash
python tools/ttf_to_gfx_webservice.py
```
3. 确保看到以下输出：
```
============================================================
TTF 转 GFX Web 服务启动中...
============================================================
访问: http://localhost:5000
API 端点:
  - GFX 转换: http://localhost:5000/convert_ttf_to_gfx
  - 位图保存: http://localhost:5000/save_bitmap_font
  - Python高质量位图: http://localhost:5000/convert_ttf_to_bitmap_python
  - 列出字体库: http://localhost:5000/list_fonts
  - 列出图片库: http://localhost:5000/list_bitmaps
  - 获取位图预览: http://localhost:5000/get_bitmap_preview
============================================================
```

### 字体库管理

#### 查询字体库
1. 打开 `web_layout.html` 页面
2. 找到 **TTF 字体管理** 部分
3. 点击 **🔍 查询字体库** 按钮
4. 系统会列出 `components/fonts/` 下的所有 `.h` 字体文件
5. 显示每个字体的文件名和大小（KB）

#### 导入字体
1. 在字体列表中找到需要的字体
2. 点击 **导入** 按钮
3. 确认导入
4. include 路径会自动复制到剪贴板
5. 在 `ink_screen.cpp` 中：
   - 粘贴 `#include` 语句（例如：`#include "../fonts/fangsong16pt_bitmaps.h"`）
   - 添加绘制代码（例如：`drawFangsongString(display, x, y, "文字");`）

### 图片库管理

#### 上传并保存图片
1. 在 **📷 图片转位图** 部分上传图片
2. 调整尺寸和处理模式
3. 点击 **预览处理效果**
4. 点击 **转换为位图数组**
5. 点击 **💾 保存到服务器** 按钮
6. 位图文件会自动保存到 `components/bitmap/` 文件夹
7. 系统会显示保存路径

#### 查询图片库
1. 在 **🖼️ 图片库管理** 部分
2. 点击 **🔍 查询图片库** 按钮
3. 系统会列出 `components/bitmap/` 下的所有 `.h` 位图文件
4. 显示每个位图的：
   - 文件名
   - 尺寸（宽x高）
   - 文件大小（KB）

#### 预览位图
1. 在图片库列表中点击 **预览** 按钮
2. 系统会在下方显示位图的黑白预览效果
3. 显示位图的详细信息（文件名、尺寸、字节数）

#### 导入位图
1. 在图片库列表中找到需要的位图
2. 点击 **导入** 按钮
3. 确认导入
4. include 路径会自动复制到剪贴板
5. 在 `ink_screen.cpp` 中：
   - 粘贴 `#include` 语句（例如：`#include "../bitmap/logo_bitmap.h"`）
   - 添加显示代码：
   ```cpp
   display.drawBitmap(x, y, IMAGE_BITMAP, IMAGE_WIDTH, IMAGE_HEIGHT, GxEPD_BLACK);
   ```

## 📁 文件夹结构

```
components/
├── fonts/              # 字体文件夹
│   ├── fangsong16pt_bitmaps.h
│   ├── fangsong24pt_bitmaps.h
│   └── ...
└── bitmap/             # 图片位图文件夹（新建）
    ├── logo_bitmap.h
    ├── icon_bitmap.h
    └── README.md
```

## 💡 使用建议

### 字体管理
- 定期清理不使用的字体文件，节省空间
- 字体文件命名建议包含字号信息（如 `fangsong16pt`）
- 中文字体推荐使用 Python 高质量位图格式

### 图片管理
- 图片尺寸建议不超过墨水屏分辨率（例如 416x240）
- 照片类图片推荐使用 **抖动算法** 处理
- Logo/图标类图片可以使用 **阈值二值化** 处理
- 文件命名建议有意义（如 `company_logo`、`weather_icon`）

## 🔧 技术说明

### 后端 API
- **Flask** 框架提供 HTTP API
- **端口**: 5000
- **跨域**: 已启用 CORS

### 新增 API 端点
1. `GET /list_fonts` - 列出字体库
2. `GET /list_bitmaps` - 列出图片库
3. `POST /get_bitmap_preview` - 获取位图预览数据
4. `POST /save_image_bitmap` - 保存图片位图到服务器

### 前端功能
- **searchFontLibrary()** - 查询字体库
- **importFont(fontName)** - 导入字体
- **searchBitmapLibrary()** - 查询图片库
- **previewBitmap(filename)** - 预览位图
- **importBitmap(bitmapName)** - 导入位图
- **saveImageBitmapToServer()** - 保存位图到服务器

## ❓ 常见问题

### Q: 点击查询按钮没有反应？
A: 检查 Python 服务是否已启动，确保在终端看到 "Running on http://127.0.0.1:5000"

### Q: 显示"查询失败"？
A: 
1. 确认 Python 服务正在运行
2. 检查浏览器控制台是否有 CORS 错误
3. 确保已安装 flask-cors: `pip install flask-cors`

### Q: 预览位图显示不正确？
A: 
1. 检查位图文件格式是否正确
2. 确保文件包含 `IMAGE_WIDTH` 和 `IMAGE_HEIGHT` 定义
3. 确保位图数据格式为 `const uint8_t XXX[] PROGMEM = {...}`

### Q: 导入后如何在程序中使用？
A: 参考自动复制的 include 路径和使用示例，在 `ink_screen.cpp` 中添加相应代码并重新编译

## 📞 支持

如有问题，请检查：
1. Python 服务是否正常运行
2. 浏览器控制台是否有错误信息
3. 文件路径是否正确
4. 文件格式是否符合要求
