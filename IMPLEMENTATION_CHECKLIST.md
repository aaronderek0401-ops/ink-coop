# Web é…ç½®ç³»ç»Ÿå®ç° - æ–‡ä»¶æ¸…å•

## ğŸ“‹ æœ¬æ¬¡è¿­ä»£å®Œæˆçš„å·¥ä½œ

### ç›®æ ‡
å°† Web UI é…ç½®ç³»ç»Ÿä» ESP32 è®¾å¤‡ç«¯ç‚¹æ”¹ä¸ºæœ¬åœ° Python Flask æœåŠ¡å™¨ï¼Œä½¿å¾—å¼€å‘è¿‡ç¨‹ä¸­é…ç½®æ–‡ä»¶çš„ç¼–è¾‘æ›´åŠ é«˜æ•ˆã€‚

---

## ğŸ“ æ–°åˆ›å»ºçš„æ–‡ä»¶

### æ ¸å¿ƒæœåŠ¡å™¨æ–‡ä»¶

#### 1. `config_server.py` (10KB)
**åŠŸèƒ½**: Flask é…ç½®æœåŠ¡å™¨ï¼Œå¤„ç† Web UI çš„é…ç½®æ–‡ä»¶ I/O

**ä¸»è¦ç‰¹æ€§**:
- æä¾› RESTful API (`/api/config/focus`, `/api/config/subarray`)
- è¯»å†™ `components/resource/` ä¸­çš„ JSON é…ç½®æ–‡ä»¶
- å¯ç”¨ CORS æ”¯æŒè·¨åŸŸè¯·æ±‚
- è‡ªåŠ¨åˆ›å»ºä¸å­˜åœ¨çš„ç›®å½•
- è¯¦ç»†çš„æ—¥å¿—è®°å½•

**ç«¯ç‚¹**:
```
GET  /api/config/focus?screen_type=main|vocab
POST /api/config/focus
GET  /api/config/subarray?screen_type=main|vocab  
POST /api/config/subarray
GET  /api/config/list
GET  /api/health
GET  /
```

**è¿è¡Œ**: `python config_server.py` (ç›‘å¬ localhost:5001)

---

### è¾…åŠ©è„šæœ¬

#### 2. `init_resource.py` (2KB)
**åŠŸèƒ½**: åˆå§‹åŒ– `components/resource/` ç›®å½•å’Œç¤ºä¾‹é…ç½®æ–‡ä»¶

**åŠŸèƒ½**:
- åˆ›å»º resource ç›®å½•
- åˆ›å»ºåˆå§‹é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- æä¾›é»˜è®¤é…ç½®ç¤ºä¾‹

**è¿è¡Œ**: `python init_resource.py`

#### 3. `compress_html.py` (0.5KB)
**åŠŸèƒ½**: å‹ç¼© HTML æ–‡ä»¶ä¸º gzip æ ¼å¼

**ç”¨é€”**: å‡å° Flash å­˜å‚¨å ç”¨ï¼ˆ247KB â†’ 39KBï¼‰

**è¿è¡Œ**: `python compress_html.py`

#### 4. `start_config_server.bat` (0.3KB)
**åŠŸèƒ½**: Windows å¯åŠ¨è„šæœ¬

**ç”¨é€”**: åœ¨ Windows ä¸­åŒå‡»å³å¯å¯åŠ¨é…ç½®æœåŠ¡å™¨

**ä½¿ç”¨**: åŒå‡»æ–‡ä»¶æˆ– `.\start_config_server.bat`

---

### æ–‡æ¡£

#### 5. `CONFIG_SERVER_README.md` (8KB)
**å†…å®¹**:
- é…ç½®æœåŠ¡å™¨è¯¦ç»†ä½¿ç”¨è¯´æ˜
- API ç«¯ç‚¹æ–‡æ¡£
- é…ç½®æ–‡ä»¶æ ¼å¼è§„èŒƒ
- å·¥ä½œæµç¨‹è¯´æ˜
- æ•…éšœæ’é™¤æŒ‡å—

#### 6. `WEB_CONFIG_SYSTEM.md` (10KB)
**å†…å®¹**:
- Web é…ç½®ç³»ç»Ÿå®ç°æ€»ç»“
- é—®é¢˜åˆ†æå’Œè§£å†³æ–¹æ¡ˆ
- ç³»ç»Ÿæ¶æ„å›¾
- æ–‡ä»¶ä½ç½®æ¸…å•
- å¼€å‘å·¥ä½œæµç¨‹

#### 7. `TEST_CONFIG_SERVER.md` (12KB)
**å†…å®¹**:
- å¿«é€Ÿå¼€å§‹æµ‹è¯•æŒ‡å—
- API ç«¯ç‚¹æµ‹è¯•æ–¹æ³•ï¼ˆcurl å‘½ä»¤ç¤ºä¾‹ï¼‰
- Web UI æµ‹è¯•æ­¥éª¤
- å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ
- æ–‡ä»¶ç›‘æ§è„šæœ¬
- å®Œæ•´å·¥ä½œæµæµ‹è¯•

#### 8. `IMPLEMENTATION_SUMMARY.md` (15KB)
**å†…å®¹**:
- å®ç°æ¶æ„å’Œæµç¨‹å›¾
- æ ¸å¿ƒä»£ç å˜æ›´æ€»ç»“
- æ–‡ä»¶æ¸…å•å’Œæ€§èƒ½æŒ‡æ ‡
- å®Œæ•´å·¥ä½œæµç¨‹è¯´æ˜
- æµ‹è¯•æ£€æŸ¥æ¸…å•
- å·²çŸ¥é™åˆ¶å’Œæ”¹è¿›æ–¹å‘

---

## âœï¸ ä¿®æ”¹çš„æ–‡ä»¶

### 1. `components/grbl_esp32s3/Grbl_Esp32/data/web_layout.html` (247KB)

**ä¿®æ”¹å†…å®¹**:

#### loadFocusConfig() å‡½æ•° (è¡Œ 3544)
```javascript
// ä¿®æ”¹å‰
const response = await fetch('/getfocusconfig?screen_type=' + currentScreenMode);

// ä¿®æ”¹å
const response = await fetch('http://localhost:5001/api/config/focus?screen_type=' + currentScreenMode);
```

#### saveFocusConfig() å‡½æ•° (è¡Œ 3502)
```javascript
// ä¿®æ”¹å‰
const response = await fetch('/setfocusconfig', {...});

// ä¿®æ”¹å
const response = await fetch('http://localhost:5001/api/config/focus', {...});
```

#### loadSubArrayConfig() å‡½æ•° (è¡Œ 3788)
```javascript
// ä¿®æ”¹å‰
const response = await fetch('/getsubarrayconfig?screen_type=' + currentScreenMode);

// ä¿®æ”¹å
const response = await fetch('http://localhost:5001/api/config/subarray?screen_type=' + currentScreenMode);
```

#### saveSubArrayConfig() å‡½æ•° (è¡Œ 3740)
```javascript
// ä¿®æ”¹å‰
const response = await fetch('/setsubarrayconfig', {...});

// ä¿®æ”¹å
const response = await fetch('http://localhost:5001/api/config/subarray', {...});
```

**ç»“æœ**: 
- æ–‡ä»¶å¤§å°: 247.7 KB
- å‹ç¼©å¤§å°: 39.5 KB (84.1% å‹ç¼©æ¯”)
- é‡æ–°ç”Ÿæˆ web_layout.html.gz

---

### 2. `components/grbl_esp32s3/Grbl_Esp32/data/web_layout.html.gz` (39.5KB)
- é‡æ–°å‹ç¼©ï¼ŒåŒ…å«ä¸Šè¿° 4 å¤„ä¿®æ”¹

---

## ğŸš« æœªä¿®æ”¹çš„æ–‡ä»¶

### `components/grbl_esp32s3/Grbl_Esp32/src/WebUI/WebServer.cpp`

**åŸå› **: 
- ä¿ç•™ ESP32 ä¸Šçš„åŸæœ‰ç«¯ç‚¹ (`/getfocusconfig`, `/setfocusconfig`, `/getsubarrayconfig`, `/setsubarrayconfig`)
- ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆï¼Œä»¥é˜²æœªæ¥éœ€è¦è®¾å¤‡ç«¯ç›´æ¥å¤„ç†é…ç½®
- é¿å…ä¸å¿…è¦çš„ä¿®æ”¹å’Œé‡æ–°ç¼–è¯‘

**ç°çŠ¶**:
- æ—§ç«¯ç‚¹ä»ç„¶å®Œæ•´å­˜åœ¨
- Web UI ç°åœ¨ä½¿ç”¨æœ¬åœ°é…ç½®æœåŠ¡å™¨
- ä¸å½±å“ç°æœ‰åŠŸèƒ½

---

## ğŸ“Š æ–‡ä»¶ç»Ÿè®¡

| ç±»å‹ | æ•°é‡ | å¤§å° |
|------|------|------|
| æ–°åˆ›å»ºçš„è„šæœ¬ | 4 | ~12KB |
| æ–°åˆ›å»ºçš„æ–‡æ¡£ | 4 | ~45KB |
| ä¿®æ”¹çš„æºæ–‡ä»¶ | 1 (web_layout.html) | 247KB |
| é‡æ–°å‹ç¼©çš„æ–‡ä»¶ | 1 (web_layout.html.gz) | 39KB |
| **æ€»è®¡** | **10** | **~343KB** |

---

## ğŸ”§ é…ç½®æ–‡ä»¶ä½ç½®

### å­˜å‚¨ä½ç½®
```
components/resource/
â”œâ”€â”€ main_focusable_rects_config.json      # ä¸»ç•Œé¢ç„¦ç‚¹é…ç½®
â”œâ”€â”€ vocab_focusable_rects_config.json     # å•è¯ç•Œé¢ç„¦ç‚¹é…ç½®
â”œâ”€â”€ main_subarray_config.json             # ä¸»ç•Œé¢å­æ•°ç»„é…ç½®
â””â”€â”€ vocab_subarray_config.json            # å•è¯ç•Œé¢å­æ•°ç»„é…ç½®
```

### é…ç½®æ–‡ä»¶æ ¼å¼

**ç„¦ç‚¹é…ç½®ç¤ºä¾‹**:
```json
{
  "count": 15,
  "focusable_indices": [0, 1, 2, ...],
  "screen_type": "main"
}
```

**å­æ•°ç»„é…ç½®ç¤ºä¾‹**:
```json
{
  "sub_arrays": [
    {
      "parent_index": 0,
      "sub_indices": [5, 6, 7],
      "sub_count": 3
    }
  ],
  "screen_type": "main"
}
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. åˆå§‹åŒ–ï¼ˆç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼‰
```bash
python init_resource.py
```

### 2. å¯åŠ¨é…ç½®æœåŠ¡å™¨
```bash
python config_server.py
```
æˆ–åœ¨ Windows ä¸­åŒå‡» `start_config_server.bat`

### 3. æ‰“å¼€ Web UI
åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `web_layout.html`

### 4. æµ‹è¯•
å‚è€ƒ `TEST_CONFIG_SERVER.md` è¿›è¡Œæµ‹è¯•

---

## ğŸ“ ä½¿ç”¨å·¥ä½œæµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯åŠ¨é…ç½®æœåŠ¡å™¨               â”‚
â”‚  python config_server.py       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰“å¼€ Web UI (web_layout.html) â”‚
â”‚  åœ¨æµè§ˆå™¨ä¸­                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‚¹å‡»"åŠ è½½ç„¦ç‚¹é…ç½®"             â”‚
â”‚  â†’ ä» components/resource/ è¯»å–â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¼–è¾‘é…ç½®ï¼ˆå¤é€‰æ¡†ç­‰ï¼‰          â”‚
â”‚  â†’ ä¿®æ”¹å­˜å‚¨åœ¨æµè§ˆå™¨å†…å­˜ä¸­       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‚¹å‡»"ä¿å­˜ç„¦ç‚¹é…ç½®"             â”‚
â”‚  â†’ å†™å…¥ components/resource/   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡ä»¶å·²æ›´æ–° (JSON)             â”‚
â”‚  å¯ä»¥æäº¤åˆ° Git ç‰ˆæœ¬æ§åˆ¶        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª éªŒè¯æ¸…å•

é…ç½®æœåŠ¡å™¨å¯é€šè¿‡ä»¥ä¸‹æ­¥éª¤éªŒè¯ï¼š

- [ ] `python config_server.py` æˆåŠŸå¯åŠ¨
- [ ] æµè§ˆå™¨è®¿é—® `http://localhost:5001` æ˜¾ç¤º API æ–‡æ¡£
- [ ] `curl http://localhost:5001/api/health` è¿”å› 200 OK
- [ ] Web UI èƒ½åŠ è½½ç„¦ç‚¹é…ç½®
- [ ] Web UI èƒ½ä¿å­˜ç„¦ç‚¹é…ç½®
- [ ] é…ç½®æ–‡ä»¶å‡ºç°åœ¨ `components/resource/` ä¸­
- [ ] æ–‡ä»¶å†…å®¹ä¸ºæœ‰æ•ˆçš„ JSON æ ¼å¼
- [ ] æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ˜¾ç¤ºæˆåŠŸçš„ HTTP è¯·æ±‚

è¯¦è§: `TEST_CONFIG_SERVER.md`

---

## ğŸ“– æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£ | ç”¨é€” | è¯»è€… |
|------|------|------|
| `CONFIG_SERVER_README.md` | æœåŠ¡å™¨è¯¦ç»†ä½¿ç”¨æ–‡æ¡£ | æ‰€æœ‰ç”¨æˆ· |
| `TEST_CONFIG_SERVER.md` | æµ‹è¯•å’Œè°ƒè¯•æŒ‡å— | å¼€å‘è€… |
| `WEB_CONFIG_SYSTEM.md` | ç³»ç»Ÿæ¶æ„å’Œæ€»ç»“ | æ¶æ„å¸ˆ |
| `IMPLEMENTATION_SUMMARY.md` | å®Œæ•´å®ç°ç»†èŠ‚ | ç»´æŠ¤è€… |

---

## âš¡ æ€§èƒ½æŒ‡æ ‡

- **æ–‡ä»¶å‹ç¼©**: 247.7 KB â†’ 39.5 KB (84.1% å‡å°‘)
- **API å“åº”æ—¶é—´**: < 10ms
- **æ–‡ä»¶è¯»å–æ—¶é—´**: < 5ms
- **æ–‡ä»¶å†™å…¥æ—¶é—´**: < 10ms
- **æ”¯æŒçš„å¹¶å‘è¿æ¥**: å–å†³äº Flask é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒé»˜è®¤ä¸º 1ï¼‰

---

## ğŸ”’ å®‰å…¨æ€§æ³¨æ„

âš ï¸ **æ­¤é…ç½®æœåŠ¡å™¨ä»…ç”¨äºå¼€å‘ç¯å¢ƒï¼**

**å¼€å‘ç‰¹æ€§**:
- âœ… CORS å¯ç”¨ï¼ˆä»»ä½•æºï¼‰
- âœ… Debug æ¨¡å¼å¯ç”¨
- âœ… æ— èº«ä»½éªŒè¯
- âœ… æ— è¯·æ±‚é™åˆ¶

**ç”Ÿäº§ç¯å¢ƒéœ€è¦**:
- âŒ é™åˆ¶ CORS æº
- âŒ ç¦ç”¨ Debug
- âœ… æ·»åŠ è®¤è¯
- âœ… å®ç°é€Ÿç‡é™åˆ¶
- âœ… ä½¿ç”¨ HTTPS
- âœ… è·¯å¾„éªŒè¯

---

## ğŸ¯ è¾¾æˆç›®æ ‡

âœ… **é…ç½®æ–‡ä»¶æœ¬åœ°åŒ–**: æ–‡ä»¶å­˜å‚¨åœ¨ `components/resource/`
âœ… **Web UI æ”¹è¿›**: ä½¿ç”¨æœ¬åœ° Flask æœåŠ¡å™¨è€Œé ESP32
âœ… **å¼€å‘æ•ˆç‡**: æ— éœ€ç¼–è¯‘çƒ§å½•å³å¯ä¿®æ”¹é…ç½®
âœ… **ç‰ˆæœ¬æ§åˆ¶**: é…ç½®æ–‡ä»¶å¯çº³å…¥ Git ç®¡ç†
âœ… **æ–‡æ¡£å®Œæ•´**: 4 ä»½è¯¦ç»†æ–‡æ¡£è¦†ç›–æ‰€æœ‰æ–¹é¢
âœ… **æ˜“äºä½¿ç”¨**: ä¸€æ¡å‘½ä»¤å¯åŠ¨æœåŠ¡å™¨

---

## ğŸ“ æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ

1. æŸ¥çœ‹ `TEST_CONFIG_SERVER.md` çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. æ£€æŸ¥æœåŠ¡å™¨è¾“å‡ºæ—¥å¿—
3. ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ£€æŸ¥ç½‘ç»œè¯·æ±‚
4. éªŒè¯æ–‡ä»¶æƒé™

---

**å®ç°æ—¥æœŸ**: 2025-12-16
**ç‰ˆæœ¬**: 1.0
**çŠ¶æ€**: âœ… å®Œæˆ
