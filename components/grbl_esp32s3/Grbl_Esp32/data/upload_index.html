<html>

<head>
  <style>
    html {
      font-family: sans-serif;
      -ms-text-size-adjust: 100%;
      -webkit-text-size-adjust: 100%;
      font-size: 10px;
    }

    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size: 14px;
      line-height: 1.42857143;
      color: #333;
      background-color: #fff;
    }

    table {
      border: 0;
      border-spacing: 0;
      max-width: 100%;
    }

    td {
      white-space: nowrap;
      padding: 2mm;
    }

    th {
      text-align: left;
    }

    .table>tbody>tr>td,
    .table>tbody>tr>th,
    .table>thead>tr>td,
    .table>thead>tr>th {
      padding: 8px;
      line-height: 1.42857143;
      vertical-align: top;
      border-top: 1px solid #ddd;
    }

    .table-striped>tbody>tr:nth-of-type(odd) {
      background-color: #f9f9f9;
    }

    a {
      position: relative;
      display: block;
      padding: 10px 15px;
      text-decoration: none;
      color: #ccc;
    }

    .active {
      color: #fff;
      background-color: #000;
    }

    .active a,
    a:focus,
    a:hover {
      color: #fff;
    }

    .panel {
      margin-bottom: 20px;
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
      box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
    }

    .panel-body {
      padding: 15px;
    }

    .panel-heading {
      padding: 10px 15px;
      color: #333;
      background-color: #f5f5f5;
      border-color: #ddd;
      border-top-right-radius: 3px;
      border-top-left-radius: 3px;
      border-bottom: 1px solid #ddd;
      font-weight: bold;
      /* 将文本加粗 */
    }

    .form-control {
      display: block;
      width: auto;
      height: 34px;
      padding: 6px 12px;
      font-size: 14px;
      line-height: 1.42857143;
      color: #555;
      background-color: #fff;
      background-image: none;
      border: 1px solid #ccc;
      border-radius: 4px;
      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
      -o-transition: border-color ease-in-out 0.15s,
        box-shadow ease-in-out 0.15s;
    }

    .form-control:focus {
      border-color: #66afe9;
      outline: 0;
      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075),
        0 0 8px rgba(102, 175, 233, 0.6);
    }

    .form-group {
      margin-bottom: 15px;
    }

    .btn {
      display: inline-block;
      margin-bottom: 0;
      font-weight: 400;
      text-align: center;
      vertical-align: middle;
      -ms-touch-action: manipulation;
      touch-action: manipulation;
      cursor: pointer;
      background-image: none;
      border: 1px solid transparent;
      white-space: nowrap;
      padding: 6px 12px;
      font-size: 14px;
      line-height: 1.42857143;
      border-radius: 4px;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    .btn-primary {
      color: #fff;
      background-color: #337ab7;
      border-color: #2e6da4;
    }

    .btn-primary.active,
    .btn-primary.focus,
    .btn-primary.hover,
    .btn-primary:active,
    .btn-primary:focus,
    .btn-primary:hover {
      color: #fff;
      background-color: #286090;
      border-color: #122b40;
    }

    .btnimg {
      cursor: hand;
      border-radius: 6px;
      border: 1px solid #fff;
    }

    .btnimg:hover {
      background-color: #f0f0f0;
      border-color: #6c6c6c;
      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px grey;
      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px grey;
    }

    .btnroundimg {
      cursor: hand;
      border-radius: 30px;
    }

    .btnroundimg:hover {
      background-color: #f0f0f0;
      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px grey;
      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px grey;
    }

    .blacklink,
    .blacklink:active {
      color: #000;
    }

    .blacklink:hover {
      color: #000;
    }

    input[type="file"]::-webkit-file-upload-button {
      display: inline-block;
      margin-bottom: 0;
      font-weight: 400;
      text-align: center;
      vertical-align: middle;
      -ms-touch-action: manipulation;
      touch-action: manipulation;
      cursor: pointer;
      background-image: none;
      border: 1px solid transparent;
      white-space: nowrap;
      padding: 6px 12px;
      font-size: 14px;
      line-height: 1.42857143;
      border-radius: 4px;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      color: #fff;
      background-color: #5bc0de;
      border-color: #46b8da;
    }

    input[type="file"]::-webkit-file-upload-button:focus {
      display: inline-block;
      margin-bottom: 0;
      font-weight: 400;
      text-align: center;
      vertical-align: middle;
      -ms-touch-action: manipulation;
      touch-action: manipulation;
      cursor: pointer;
      background-image: none;
      border: 1px solid transparent;
      white-space: nowrap;
      padding: 6px 12px;
      font-size: 14px;
      line-height: 1.42857143;
      border-radius: 4px;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      color: #fff;
      background-color: #31b0d5;
      border-color: #1b6d85;
    }

    input[type="file"]::-webkit-file-upload-button:hover {
      display: inline-block;
      margin-bottom: 0;
      font-weight: 400;
      text-align: center;
      vertical-align: middle;
      -ms-touch-action: manipulation;
      touch-action: manipulation;
      cursor: pointer;
      background-image: none;
      border: 1px solid transparent;
      white-space: nowrap;
      padding: 6px 12px;
      font-size: 14px;
      line-height: 1.42857143;
      border-radius: 4px;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      color: #fff;
      background-color: #31b0d5;
      border-color: #269abc;
    }

    .panel-footer {
      padding: 10px 15px;
      color: #31708f;
      background-color: #f5f5f5;
      border-color: #ddd;
      border-top: 1px solid #ddd;
    }

    .panel-footer {
      padding: 10px 15px;
      color: #31708f;
      background-color: #f5f5f5;
      border-color: #ddd;
      border-top: 1px solid #ddd;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 10000;
      padding-top: 100px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: #000;
      background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      border-bottom-left-radius: 10px;
      border-bottom-right-radius: 10px;
      border: 2px solid #337ab7;
      box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
      position: relative;
      margin: auto;
      padding: 0;
      background-color: #fefefe;
    }

    .modal-header {
      padding: 2px 16px;
      color: #0f0f0f;
      background-color: #f2f2f2;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      border-bottom: 1px solid #cfcfcf;
    }

    .modal-body {
      padding: 10px 16px;
    }

    .modal-footer {
      padding: 16px 16px;
      height: 4.5em;
      color: #0f0f0f;
      background-color: #f2f2f2;
      border-top: 1px solid #cfcfcf;
      border-bottom-left-radius: 10px;
      border-bottom-right-radius: 10px;
    }

    .hide_it {
      display: none;
    }

    @media (min-width: 768px) {
      .modal-content {
        width: 580px;
      }
    }

    @media screen and (max-width: 767px) {
      .modal-content {
        width: 100%;
      }
    }



    #banner {
      width: 100%;
      height: 200;
      /* 将高度单位设置为像素(px) */
      overflow: hidden;
      position: relative;
      /* border: 1px solid #ccc; */
      /* 添加边框以突出横幅 */
    }

    #banner img {
      position: absolute;
      top: 0;
      left: 0;
      object-fit: cover;
      width: 100%;
      height: auto;
    }
  </style>
  <title>ESP3D tool page</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.3/pako.min.js"></script>
  <style>
    #drop_zone {
      display: none;
      /* 初始状态隐藏 */
      width: 100%;
      height: 100%;
      border: 2px dashed #ccc;
      border-radius: 10px;
      text-align: center;
      line-height: 100vh;
      /* 让文字在垂直方向居中 */
      cursor: pointer;
      position: fixed;
      /* 固定位置 */
      top: 0;
      /* 顶部对齐 */
      left: 0;
      /* 左侧对齐 */
      background-color: rgba(255, 255, 255, 0.5);
      /* 半透明白色背景 */
    }
    .notification {
        position: fixed;
        left: 50%;
        transform: translateX(-50%);
        width: 50%; /* 宽度为页面的50% */
        padding: 2%; /* 控制通知的高度 */
        background-color: rgb(223, 223, 223); /* 白色背景，透明度0.9 */
        border-radius: 10px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3); /* 阴影效果 */
        backdrop-filter: blur(10px); /* 毛玻璃效果 */
        z-index: 9999;
        transition: top 0.5s ease-in-out;
    }
    #btn {
        position: fixed;
        top: 10px;
        left: 10px; /* 放置在最左边 */
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
    }
    .content-wrapper {
    text-align: center; /* 文本居中 */
    font-size: 2em;
    font-weight: bold;


}
  </style>
</head>

<body>
  <div class="panel">
    <table width="100%">
      <tr>
        <td>
          <a class="btnimg" id="homelink" href="https://www.longer3d.com/" target="_blank">
            <svg width="1em" height="1em" viewBox="0 0 190.43 187.83">
              <g>
                <path
                  d="M91.9,0c2.09,0,4.18,0,6.27,0c3.94,0.97,8,1.6,11.78,3.01c2.81,1.05,5.24,3.12,7.84,4.74c-2.47,1.58-4.75,3.71-7.44,4.66c-16.38,5.79-33.38,10.16-49.12,17.31c-10.69,4.86-25.66,11.85-28.1,20.79c-4.5,16.49,0.05,35.21-1.51,52.79c-1.48,16.7,2.59,28.33,19.3,33.76c20.76,6.75,38.75,27.2,63.99,11.59c10.47-6.48,22.2-10.98,33.49-16.08c8.92-4.03,15.59-46.94,8.09-53.41c-0.51-0.44-1.47-1.09-1.78-0.9c-9.1,5.43-25.49,10.55-25.82,16.55c-1.06,18.9-12.2,24.4-26.44,28.81c-1.19,0.37-4.66-1.99-4.68-3.14c-0.28-13.78-1.16-27.69,0.45-41.29c0.67-5.71,5.65-13.25,10.73-15.71c22.31-10.79,45.57-19.6,68.08-30.02c10.4-4.82,12.88-0.49,12.92,8.44c0.11,28.27,1.43,56.64-0.75,84.74c-0.73,9.4-8.56,21.12-16.66,26.49c-16.35,10.85-35.21,17.88-52.83,26.88c-14.09,7.19-27.49,11.79-43.23,2.99c-18.78-10.5-38.95-18.51-57.77-28.94c-7.28-4.04-12.53-11.75-18.7-17.78C0,102.44,0,68.6,0,34.77c4.83-4.4,8.96-11.04,14.62-12.83C40.14,13.88,66.1,7.19,91.9,0z" />
                <path
                  d="M64.09,87.44c0.24-41.79-4.8-32.23,38.96-49.81c12.88-5.17,25.5-11.89,38.91-14.6c11.84-2.38,24.61-0.22,36.97,0.14c0.99,0.03,1.94,1.66,2.91,2.55c-1,0.7-1.91,1.6-3.01,2.07c-24.02,10.08-49.03,18.4-71.59,31.07c-8.01,4.5-11.62,19.16-14.39,29.91c-2.29,8.89,0.09,18.9-0.69,28.33c-0.16,1.94-5.57,5.41-7.82,4.9C62.66,117.11,61.6,100.99,64.09,87.44z" />
              </g>
            </svg>
            <span class="blacklink">LONGER3D</span>
          </a>
        </td>
        <td>
          <a class="btnimg" id="homelink" href="https://www.longer3d.com/pages/support" target="_blank">
            <svg width="1em" height="1em" viewBox="0 0 512 512">
              <g>
                <path
                  d="M379.734355,174.506667 C373.121022,106.666667 333.014355,-2.13162821e-14 209.067688,-2.13162821e-14 C85.1210217,-2.13162821e-14 45.014355,106.666667 38.4010217,174.506667 C15.2012632,183.311569 -0.101643453,205.585799 0.000508304259,230.4 L0.000508304259,260.266667 C0.000508304259,293.256475 26.7445463,320 59.734355,320 C92.7241638,320 119.467688,293.256475 119.467688,260.266667 L119.467688,230.4 C119.360431,206.121456 104.619564,184.304973 82.134355,175.146667 C86.4010217,135.893333 107.307688,42.6666667 209.067688,42.6666667 C310.827688,42.6666667 331.521022,135.893333 335.787688,175.146667 C313.347976,184.324806 298.68156,206.155851 298.667688,230.4 L298.667688,260.266667 C298.760356,283.199651 311.928618,304.070103 332.587688,314.026667 C323.627688,330.88 300.801022,353.706667 244.694355,360.533333 C233.478863,343.50282 211.780225,336.789048 192.906491,344.509658 C174.032757,352.230268 163.260418,372.226826 167.196286,392.235189 C171.132153,412.243552 188.675885,426.666667 209.067688,426.666667 C225.181549,426.577424 239.870491,417.417465 247.041022,402.986667 C338.561022,392.533333 367.787688,345.386667 376.961022,317.653333 C401.778455,309.61433 418.468885,286.351502 418.134355,260.266667 L418.134355,230.4 C418.23702,205.585799 402.934114,183.311569 379.734355,174.506667 Z M76.8010217,260.266667 C76.8010217,269.692326 69.1600148,277.333333 59.734355,277.333333 C50.3086953,277.333333 42.6676884,269.692326 42.6676884,260.266667 L42.6676884,230.4 C42.6676884,224.302667 45.9205765,218.668499 51.2010216,215.619833 C56.4814667,212.571166 62.9872434,212.571166 68.2676885,215.619833 C73.5481336,218.668499 76.8010217,224.302667 76.8010217,230.4 L76.8010217,260.266667 Z M341.334355,230.4 C341.334355,220.97434 348.975362,213.333333 358.401022,213.333333 C367.826681,213.333333 375.467688,220.97434 375.467688,230.4 L375.467688,260.266667 C375.467688,269.692326 367.826681,277.333333 358.401022,277.333333 C348.975362,277.333333 341.334355,269.692326 341.334355,260.266667 L341.334355,230.4 Z">
                </path>
              </g>
            </svg>
            <span class="blacklink">Support</span>
          </a>
        </td>
        <td>
          <a class="btnimg" id="homelink" href="https://www.facebook.com/longer3dprinter" target="_blank">
            <svg width="1em" height="1em" viewBox="0 0 24 24 ">
              <g>
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M20 1C21.6569 1 23 2.34315 23 4V20C23 21.6569 21.6569 23 20 23H4C2.34315 23 1 21.6569 1 20V4C1 2.34315 2.34315 1 4 1H20ZM20 3C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H15V13.9999H17.0762C17.5066 13.9999 17.8887 13.7245 18.0249 13.3161L18.4679 11.9871C18.6298 11.5014 18.2683 10.9999 17.7564 10.9999H15V8.99992C15 8.49992 15.5 7.99992 16 7.99992H18C18.5523 7.99992 19 7.5522 19 6.99992V6.31393C19 5.99091 18.7937 5.7013 18.4813 5.61887C17.1705 5.27295 16 5.27295 16 5.27295C13.5 5.27295 12 6.99992 12 8.49992V10.9999H10C9.44772 10.9999 9 11.4476 9 11.9999V12.9999C9 13.5522 9.44771 13.9999 10 13.9999H12V21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3H20Z"
                  fill="#0F0F0F"></path>
              </g>
            </svg>
            <span class="blacklink">Facebook</span>
          </a>
        </td>


        <td style="width: 100%"></td>
        <td onclick="RL();" id="loginicon">
          <a class="btnimg"><svg width="1.3em" height="1.2em" viewBox="0 0 1300 1200">
              <g transform="translate(50,1200) scale(1, -1)">
                <path fill="black"
                  d="M900 800v200q0 83 -58.5 141.5t-141.5 58.5h-300q-82 0 -141 -59t-59 -141v-200h-100q-41 0 -70.5 -29.5t-29.5 -70.5v-600q0 -41 29.5 -70.5t70.5 -29.5h900q41 0 70.5 29.5t29.5 70.5v600q0 41 -29.5 70.5t-70.5 29.5h-100zM400 800v150q0 21 15 35.5t35 14.5h200 q20 0 35 -14.5t15 -35.5v-150h-300z" />
              </g>
            </svg></a>
        </td>
        <td style="text-align: right">
          <span id="FWVERSION" class="blacklink"></span>
        </td>
      </tr>
    </table>
  </div>
  <!-- <div class="panel">
    <div class="panel-heading">
      <span style="display: block; text-align: center; font-size: 1.5em; font-weight: bold;">Made by Longer Nano</span>
    </div>
    <div id="banner">
      <img
        src="https://cdn.shopify.com/s/files/1/0517/8812/0247/files/1_1_2a2f6752-e681-4de7-afad-8f0d3b5f0731.jpg?v=1708414182"
        alt="Banner Image">
    </div>
  </div> -->
  <center>
    <h2 id="MSG"></h2>
  </center>
  <script>
    var banner = document.getElementById("banner");
    var img = banner.querySelector("img");
    var height = banner.clientHeight;
    var imgHeight = img.clientHeight;
    var direction = -1; // 1表示向下移动，-1表示向上移动
    var interval = 16.67; // 设置每次移动的时间间隔，单位为毫秒，这里设置为1秒

    function moveImg() {
      var top = parseInt(img.style.top) || 0;
      top += direction;
      img.style.top = top + "px";
      // 如果图片触碰到容器的上下边缘，则改变移动方向
      if ((img.clientHeight - height) > 0) {
        if (top <= -(img.clientHeight - height)) {
          direction = 1;
        } else if (top >= 0) {
          direction = -1;
        }
      } else {
        if (top <= 0) {
          direction = 1;
        } else if (top >= -(img.clientHeight - height)) {
          direction = -1;
        }
      }
      setTimeout(moveImg, interval); // 使用setTimeout来控制移动的时间间隔
    }

    moveImg();
  </script>

  </script>
  <div class="panel" style="display: none;">
    <label for="level">Compression Level:</label>
    <input type="number" id="level" value="9">
    <label for="windowBits">Window Bits:</label>
    <input type="number" id="windowBits" value="13">
  </div>
  <div id="drop_zone">Drop files here to compress</div>
  <script>
    var dropZone = document.getElementById('drop_zone');

    document.addEventListener('dragover', function (e) {
      e.preventDefault();
      e.stopPropagation();
      dropZone.style.display = 'block'; // 显示拖放区域
    });

    document.addEventListener('dragleave', function (e) {
      e.preventDefault();
      e.stopPropagation();
      // 检查鼠标移出时是否真的没有拖入文件
      if (e.clientX === 0 && e.clientY === 0) {
        dropZone.style.display = 'none'; // 隐藏拖放区域
      }
    });

    dropZone.addEventListener('drop', function (e) {
      e.preventDefault();
      e.stopPropagation();
      this.style.display = 'none'; // 隐藏拖放区域
      var files = e.dataTransfer.files;
      for (var i = 0; i < files.length; i++) {
        compressFileAndSend(files[i]);
      }
    });

    function compressFile(file) {
      var reader = new FileReader();
      reader.onload = function () {
        var data = new Uint8Array(this.result);
        var level = parseInt(document.getElementById('level').value);
        var windowBits = parseInt(document.getElementById('windowBits').value);
        var compressedData = pako.gzip(data, { level: level, windowBits: windowBits });
        var blob = new Blob([compressedData], { type: 'application/gzip' });
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = file.name + '.gz';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };
      reader.readAsArrayBuffer(file);
    }
  </script>

  <div class="panel hide_it" id="FILESYSTEM">
    <div class="panel-heading">Flash Filesystem(Select or drop file here to upload)</div>
    <div class="panel-body">
      <input type="file" id="file-select" name="myfiles[]" multiple="multiple" />
      <input class="btn btn-primary" type="button" id="upload-button" onclick="Sendfile();"
        value="Upload" />&nbsp;&nbsp;<progress style="visibility: hidden" name="prg" id="prg"
        max="100"></progress><br /><br />
      <div class="panel">
        <div class="panel-body">
          <table>
            <tr>
              <td width="0%">
                <input class="btn btn-primary" type="button" onclick="SendCommand('list','all');" value="Refresh" />
              </td>
              <td width="0%">
                <div onclick="Createdir()" class="btnimg">
                  <svg width="40" height="40" viewBox="0 0 40 40">
                    <rect x="5" y="10" width="30" height="20" rx="2" ry="2" fill="#31b0d5" />
                    <rect x="20" y="5" width="15" height="15" rx="2" ry="2" fill="#31b0d5" />
                    <text x="15" y="25" font-size="18" font-weight="800" fill="white">
                      +
                    </text>
                  </svg>
                </div>
              </td>
              <td width="100%">
                <div id="path" class="info">&nbsp;</div>
              </td>
            </tr>
          </table>
          <table class="table table-striped" style="border: 1px">
            <thead>
              <tr>
                <th width="0%">Type</th>
                <th>Name</th>
                <th>Size</th>
                <th id="FS_time">Time</th>
                <th width="0%"></th>
                <th width="100%"></th>
              </tr>
            </thead>
            <tbody id="file_list"></tbody>
          </table>
        </div>
        <div class="panel-footer" id="status"></div>
      </div>
    </div>
  </div>
  <div class="panel hide_it" id="FWUPDATE">
    <div class="panel-heading">Firmware Update</div>
    <div class="panel-body">
      <table>
        <tr>
          <td><input type="file" id="fw-select" name="myfiles[]" /></td>
          <td>
            <input class="btn btn-primary" type="button" id="ubut" onclick="Uploadfile();" value="Update" />
          </td>
          <td>
            <progress style="visibility: hidden" name="prgfw" id="prgfw" max="100"></progress>
          </td>
          <td>
            <span id="msg" style="visibility: hidden">Restarting, please wait....</span><span id="counter"></span>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <div id="loginpage" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Identification</h3>
      </div>
      <div class="modal-body">
        <span><span class="modal-text" translate>User:</span>
          <input class="form-control" type="text" id="lut" style="width: auto" /></span>
        <hr />
        <span><span class="modal-text" translate>Password:</span>
          <input class="form-control" type="password" id="lpt" style="width: auto" /></span><br />
      </div>
      <div class="modal-footer">
        <input type="button" class="btn btn-primary" onclick="SLR()" value="Submit" />
      </div>
    </div>
  </div>
  <script>
    var ws_source,
      xmlhttpupload,
      currentpath = "/",
      authentication = !1,
      websocket_port = 0,
      websocket_IP = "",
      async_webcommunication = !1,
      page_id = "",
      log_off = !1,
      websocket_started = !1,
      esp_error_message = "",
      esp_error_code = 0,
      typeupload = 0;
    function navbar() {
      var e = "<table><tr>",
        t = currentpath.split("/"),
        n = "/",
        i = 1;
      for (
        e +=
        "<td class='btnimg'  onclick=\"currentpath='/'; SendCommand('list','all');\">/</td>";
        i < t.length - 1;

      )
        (e +=
          "<td class='btnimg' onclick=\"currentpath='" +
          (n += t[i] + "/") +
          "'; SendCommand('list','all');\">" +
          t[i] +
          "</td><td>/</td>"),
          i++;
      return (e += "</tr></table>");
    }
    function trash_icon() {
      return (
        "<rect x='52' y='12' rx='6' ry='6' width='25' height='7' style='fill:red;' />",
        "<rect x='52' y='16' width='25' height='2' style='fill:white;' />",
        "<rect x='30' y='18' rx='6' ry='6' width='67' height='100' style='fill:red;' />",
        "<rect x='20' y='18' rx='10' ry='10' width='87' height='14' style='fill:red;' />",
        "<rect x='20' y='29' width='87' height='3' style='fill:white;' />",
        "<rect x='40' y='43' rx='7' ry='7' width='7' height='63' style='fill:white;' />",
        "<rect x='60' y='43' rx='7' ry='7' width='7' height='63' style='fill:white;' />",
        "<rect x='80' y='43' rx='7' ry='7' width='7' height='63' style='fill:white;' /></svg>",
        "<svg width='24' height='24' viewBox='0 0 128 128'><rect x='52' y='12' rx='6' ry='6' width='25' height='7' style='fill:red;' /><rect x='52' y='16' width='25' height='2' style='fill:white;' /><rect x='30' y='18' rx='6' ry='6' width='67' height='100' style='fill:red;' /><rect x='20' y='18' rx='10' ry='10' width='87' height='14' style='fill:red;' /><rect x='20' y='29' width='87' height='3' style='fill:white;' /><rect x='40' y='43' rx='7' ry='7' width='7' height='63' style='fill:white;' /><rect x='60' y='43' rx='7' ry='7' width='7' height='63' style='fill:white;' /><rect x='80' y='43' rx='7' ry='7' width='7' height='63' style='fill:white;' /></svg>"
      );
    }
    function back_icon() {
      return "<svg width='24' height='24' viewBox='0 0 24 24'><path d='M7,3 L2,8 L7,13 L7,10 L17,10 L18,11 L18,15 L17,16 L10,16 L9,17 L9,19 L10,20 L20,20 L22,18 L22,8 L20,6 L7,6 z' stroke='black' fill='white' /></svg>";
    }
    function select_dir(e) {
      (currentpath += e + "/"), SendCommand("list", "all");
    }
    function compareStrings(e, t) {
      return (e = e.toLowerCase()) < (t = t.toLowerCase())
        ? -1
        : t < e
          ? 1
          : 0;
    }
    function dispatchfilestatus(e) {
      var t = "",
        n = !1;
      if (
        ((t = "&nbsp;&nbsp;Status: " + e.status),
          (t += "&nbsp;&nbsp;|&nbsp;&nbsp;Total space: " + e.total),
          (t += "&nbsp;&nbsp;|&nbsp;&nbsp;Used space: " + e.used),
          (t += "&nbsp;&nbsp;|&nbsp;&nbsp;Occupation: "),
          (t +=
            "<meter min='0' max='100' high='90' value='" +
            e.occupation +
            "'></meter>&nbsp;" +
            e.occupation +
            "%"),
          (document.getElementById("status").innerHTML = t),
          (t = ""),
          "/" != currentpath)
      ) {
        var i = currentpath.lastIndexOf("/", currentpath.length - 2);
        t +=
          "<tr style='cursor:hand;' onclick=\"currentpath='" +
          currentpath.slice(0, i + 1) +
          "'; SendCommand('list','all');\"><td >" +
          back_icon() +
          "</td><td colspan='4'> Up..</td></tr>";
      }
      e.files.sort(function (e, t) {
        return compareStrings(e.name, t.name);
      }),
        "/" == currentpath && (n = !0);
      for (var l = !1, o = 0; o < e.files.length; o++)
        "-1" != String(e.files[o].size) &&
          ((t += "<TR>"),
            (t +=
              "<td><svg height='24' width='24' viewBox='0 0 24 24' >    <path d='M1,2 L1,21 L2,22 L16,22 L17,21 L17,6 L12,6 L12,1  L2,1 z' stroke='black' fill='white' /><line x1='12' y1='1' x2='17' y2='6' stroke='black' stroke-width='1'/>"),
            (t += "</svg></td>"),
            (t +=
              '<TD class=\'btnimg\' style="padding:0px;"><a href="' +
              e.path +
              e.files[o].name +
              '" target=_blank><div class="blacklink">'),
            (t += e.files[o].name),
            ("index.html.gz" != e.files[o].name &&
              "index.html" != e.files[o].name) ||
            (n = !1),
            (t += "</div></a></TD><TD>"),
            (t += e.files[o].size),
            (t += "</TD>"),
            e.files[o].hasOwnProperty("time")
              ? ((l = !0),
                (t += "<TD>"),
                (t += e.files[o].time),
                (t += "</TD>"))
              : (t += "<TD></TD>"),
            (t +=
              "<TD width='0%'><div class=\"btnimg\" onclick=\"Delete('" +
              e.files[o].name +
              "')\">"),
            (t += trash_icon()),
            (t += "</div></TD><td></td></TR>"));
      for (var r = 0; r < e.files.length; r++)
        "-1" == String(e.files[r].size) &&
          ((t +=
            "<TR><td><svg height='24' width='24' viewBox='0 0 24 24' ><path d='M19,11 L19,8 L18,7 L8,7 L8,5 L7,4 L2,4 L1,5 L1,22 L19,22 L20,21 L23,11 L5,11 L2,21 L1,22' stroke='black' fill='white' /></svg></td>"),
            (t +=
              "<TD  class='btnimg blacklink' style='padding:10px 15px;' onclick=\"select_dir('" +
              e.files[r].name +
              "');\">"),
            (t += e.files[r].name),
            (t += "</TD><TD></TD><TD></TD>"),
            e.files[r].hasOwnProperty("time"),
            (l = !0),
            (t +=
              "<TD width='0%'><div class=\"btnimg\" onclick=\"Deletedir('" +
              e.files[r].name +
              "')\">"),
            (t += trash_icon()),
            (t += "</div></TD><td></td></TR>"));
      (document.getElementById("FS_time").innerHTML = l ? "" : "Time"),
        // (document.getElementById("MSG").innerHTML = n
        //   ? "File index.html.gz is missing, please upload it"
        //   : "<a href='/' class= 'btn btn-primary'>Go to ESP3D interface</a>"),
        (document.getElementById("file_list").innerHTML = t),
        (document.getElementById("path").innerHTML = navbar());
    }
    function Delete(e) {
      confirm("Confirm deletion of file: " + e) && SendCommand("delete", e);
    }
    function Deletedir(e) {
      confirm("Confirm deletion of directory: " + e) &&
        SendCommand("deletedir", e);
    }
    function Createdir() {
      var e = prompt("Directory name", "");
      null != e && SendCommand("createdir", e.trim());
    }
    function SendCommand(e, t) {
      var n = new XMLHttpRequest(),
        i = "/files?action=" + e;
      (document.getElementById("MSG").innerHTML = "Connecting..."),
        (i += "&filename=" + encodeURI(t)),
        (i += "&path=" + encodeURI(currentpath)),
        (n.onreadystatechange = function () {
          4 == n.readyState &&
            (200 == n.status
              ? dispatchfilestatus(JSON.parse(n.responseText))
              : 401 == n.status
                ? RL()
                : (console.log(n.status), FWError()));
        }),
        n.open("GET", i, !0),
        n.send();
    }
    function Sendfile() {
      var files = document.getElementById("file-select").files;
      if (files.length != 0) {
        console.log("Selected files:");
        for (var i = 0; i < files.length; i++) {
          var file = files[i];
          var filePath = file.webkitRelativePath || file.name;
          console.log("File name:", file.name);
          console.log("File size:", file.size, "bytes");
          console.log("File type:", file.type);
          console.log("File last modified date:", file.lastModifiedDate);

          // 压缩文件
          compressFileAndSend(file);
        }
      } else {
        console.log("No files selected.");
      }
    }
    function compressFileAndSend(file) {
      var reader = new FileReader();
      reader.onload = function () {
        var data = new Uint8Array(this.result);
        var level = parseInt(document.getElementById('level').value);
        var windowBits = parseInt(document.getElementById('windowBits').value);
        var compressedData = pako.gzip(data, { level: level, windowBits: windowBits });
        var blob = new Blob([compressedData], { type: 'application/gzip' });

        // 将压缩后的文件发送到服务器
        sendFileToServer(blob, file.name + '.gz');
      };
      reader.readAsArrayBuffer(file);
    }

    function sendFileToServer(fileBlob, fileName) {
      (document.getElementById("upload-button").value = "Uploading..."),
        (document.getElementById("prg").style.visibility = "visible");

      var formData = new FormData();
      formData.append('path', currentpath);
      formData.append('size', fileBlob.size);
      formData.append('file', fileBlob, fileName);
      var xmlhttpupload = new XMLHttpRequest();
      xmlhttpupload.open('POST', '/upload', true);
      xmlhttpupload.upload.addEventListener('progress', function (e) {
        if (e.lengthComputable) {
          var t = (e.loaded / e.total) * 100;
          console.log('Upload progress:', t.toFixed(0) + '%');
          (document.getElementById("prg").value = t), (document.getElementById("upload-button").value = "Uploading ..." + t.toFixed(0) + "%");
        }
      }, !1

      ), (typeupload = 1),
        xmlhttpupload.onload = function () {
          if (xmlhttpupload.status === 200) {
            createNotification("Upload successful");
            console.log('Upload successful');
            ((document.getElementById("upload-button").value = "Upload"),
              (document.getElementById("prg").style.visibility = "hidden"),
              (document.getElementById("file-select").value = ""),
              dispatchfilestatus(JSON.parse(xmlhttpupload.responseText)))
          } else {
            createNotification("Upload failed");

            console.error('Upload failed');
          }
        };
      xmlhttpupload.send(formData);
    }
    function getPCTime() {
      var e = new Date();
      return (
        e.getFullYear() +
        "-" +
        padNumber(e.getMonth() + 1, 2) +
        "-" +
        padNumber(e.getDate(), 2) +
        "-" +
        padNumber(e.getHours(), 2) +
        "-" +
        padNumber(e.getMinutes(), 2) +
        "-" +
        padNumber(e.getSeconds(), 2)
      );
    }
    function HideAll(e) {
      (log_off = !0),
        websocket_started && ws_source.close(),
        (document.title = document.title + "(disconnected)"),
        (document.getElementById("MSG").innerHTML = e),
        (document.getElementById("FILESYSTEM").style.display = "none"),
        (document.getElementById("FWUPDATE").style.display = "none");
    }
    function FWError() {
      createNotification("Failed to communicate with FW!");

      HideAll("Failed to communicate with FW!");
    }
    function FWOk() {
      createNotification("Connected");
      document.getElementById("MSG").style.display = "none";
      document.getElementById("FILESYSTEM").style.display = "block";
      document.getElementById("FWUPDATE").style.display = "block";
    }

    function InitUI() {
      var o = new XMLHttpRequest(),
        e = "/command?commandText=" + encodeURI("[ESP800]");
      (async_webcommunication = authentication = !1),
        console.log("Init UI"),
        (o.onreadystatechange = function () {
          if (4 == o.readyState) {
            var e = !1;
            if (200 == o.status) {
              var t = 0,
                n = o.responseText.split("#");
              if ((console.log(o.responseText), n.length < 3)) e = !0;
              else {
                for (var i = 0; i < n.length; i++) {
                  var l = n[i].split(":");
                  "FW version" == l[0].trim() &&
                    ((document.getElementById("FWVERSION").innerHTML =
                      "v" + l[1]),
                      t++),
                    "authentication" == l[0].trim() &&
                    ("no" == l[1].trim()
                      ? ((authentication = !1),
                        (document.getElementById(
                          "loginicon"
                        ).style.visibility = "hidden"))
                      : ((authentication = !0),
                        (document.getElementById(
                          "loginicon"
                        ).style.visibility = "visible")),
                      t++),
                    "webcommunication" == l[0].trim() &&
                    ((websocket_port = l[2].trim()),
                      (websocket_IP = l[3].trim()),
                      startSocket(),
                      t++),
                    "hostname" == l[0].trim() &&
                    ((document.title = l[1].trim()), t++);

                  "homelink" == l[0].trim() && // 新增加的判断
                    ((document.getElementById("homelink").href = l[1].trim()), t++); // 修改链接


                }
                4 == t ? (SendCommand("list", "all"), FWOk()) : (e = !0);
              }
            } else 401 == o.status ? RL() : ((e = !0), console.log(o.status));
            e && FWError();
          }
        }),
        o.open("GET", e, !0),
        o.send();
    }
    function startSocket() {
      websocket_started && ws_source.close(),
        ((ws_source = async_webcommunication
          ? new WebSocket(
            "ws://" + websocket_IP + ":" + websocket_port + "/ws",
            ["arduino"]
          )
          : new WebSocket("ws://" + websocket_IP + ":" + websocket_port, [
            "arduino",
          ])).binaryType = "arraybuffer"),
        (ws_source.onopen = function (e) {
          console.log("WS"), (websocket_started = !0);
        }),
        (ws_source.onclose = function (e) {
          (websocket_started = !1),
            console.log("~WS"),
            log_off || setTimeout(startSocket, 3e3);
        }),
        (ws_source.onerror = function (e) {
          console.log("WS", e);
        }),
        (ws_source.onmessage = function (e) {
          if (!(e.data instanceof ArrayBuffer)) {
            var t = e.data.split(":");
            2 <= t.length &&
              ("currentID" == t[0] &&
                ((page_id = t[1]), console.log("ID " + page_id)),
                "activeID" == t[0] &&
                page_id != t[1] &&
                HideAll(
                  "It seems you are connect from another location, your are now disconnected"
                ),
                "ERROR" == t[0] &&
                ((esp_error_message = t[2]),
                  (esp_error_code = t[1]),
                  console.log(t[2] + " code:" + t[1]),
                  uploadError(),
                  xmlhttpupload.abort()));
          }
        });
    }
    function uploadError() {
      0 != esp_error_code
        ? (alert(
          "Update failed(" + esp_error_code + "): " + esp_error_message
        ),
          (esp_error_code = 0))
        : alert("Update failed!"),
        1 == typeupload
          ? ((document.getElementById("upload-button").value = "Upload"),
            (document.getElementById("prg").style.visibility = "hidden"),
            (document.getElementById("file-select").value = ""),
            SendCommand("list", "all"))
          : location.reload();
    }
    function Uploadfile() {
      if (confirm("Confirm Firmware Update ?")) {
        var e = document.getElementById("fw-select").files;
        if (0 != e.length) {
          (document.getElementById("ubut").style.visibility = "hidden"),
            (document.getElementById("fw-select").style.visibility =
              "hidden"),
            (document.getElementById("msg").style.visibility = "visible"),
            (document.getElementById("msg").innerHTML = ""),
            (document.getElementById("FILESYSTEM").style.display = "none"),
            (document.getElementById("prgfw").style.visibility = "visible");
          for (var t = new FormData(), n = 0; n < e.length; n++) {
            var i = e[n];
            t.append("size", i.size), t.append("file", i, i.name);
          }
          (typeupload = 0),
            (xmlhttpupload = new XMLHttpRequest()).open(
              "POST",
              "/updatefw",
              !0
            ),
            xmlhttpupload.addEventListener(
              "progress",
              function (e) {
                if (e.lengthComputable) {
                  var t = (e.loaded / e.total) * 100;
                  (document.getElementById("prgfw").value = t),
                    (document.getElementById("msg").innerHTML =
                      "Uploading ..." + t.toFixed(0) + "%");
                }
              },
              !1
            ),
            (xmlhttpupload.onload = function () {
              if (200 === xmlhttpupload.status) {
                (document.getElementById("ubut").value = "Upload"),
                  (document.getElementById("msg").innerHTML =
                    "Restarting, please wait...."),
                  (document.getElementById("counter").style.visibility =
                    "visible"),
                  (document.getElementById("ubut").style.visibility =
                    "hidden"),
                  (document.getElementById("ubut").style.width = "0px"),
                  (document.getElementById("fw-select").value = ""),
                  (document.getElementById("fw-select").style.visibility =
                    "hidden"),
                  (document.getElementById("fw-select").style.width = "0px");
                var e = JSON.parse(xmlhttpupload.responseText);
                if (
                  (("1" != e.status && "4" != e.status && "1" != e.status) ||
                    uploadError(),
                    "2" == e.status)
                )
                  alert("Update canceled!");
                else if ("3" == e.status) {
                  var t,
                    n = 0;
                  (document.getElementById("prgfw").max = 40),
                    (t = setInterval(function () {
                      (n += 1),
                        (document.getElementById("prgfw").value = n),
                        (document.getElementById("counter").innerHTML =
                          41 - n),
                        40 < n && (clearInterval(t), location.reload());
                    }, 1e3));
                } else uploadError();
              } else uploadError();
            }),
            xmlhttpupload.send(t);
        }
      }
    }
    function RL() {
      document.getElementById("loginpage").style.display = "block";
    }
    function SLR() {
      document.getElementById("loginpage").style.display = "none";
      var e = document.getElementById("lut").value.trim(),
        t = document.getElementById("lpt").value.trim(),
        n =
          "/login?USER=" +
          encodeURIComponent(e) +
          "&PASSWORD=" +
          encodeURIComponent(t) +
          "&SUBMIT=yes",
        i = new XMLHttpRequest();
      (i.onreadystatechange = function () {
        4 == i.readyState &&
          (200 != i.status
            ? 401 == i.status
              ? RL()
              : (FWError(), console.log(i.status))
            : InitUI());
      }),
        i.open("GET", n, !0),
        i.send();
    }
    window.onload = function () {
      InitUI();
    };

    let notificationIndex = 0;
    let notifications = []; // 存储通知元素
    function createNotification(content) {
    const notification = document.createElement('div');
    notification.classList.add('notification');
    const contentWrapper = document.createElement('div'); // 创建内容包裹元素
    contentWrapper.classList.add('content-wrapper'); // 添加类名
    contentWrapper.textContent = content;
    notification.appendChild(contentWrapper); // 将内容包裹元素添加到通知中
    notification.style.top = '-100px'; // 初始位置在屏幕上方
    document.body.appendChild(notification);

    // 获取通知的 padding-top 属性，并将其转换为像素值
    const paddingTop = parseFloat(window.getComputedStyle(notification).paddingTop);

    // 更新其他通知的位置
    notifications.forEach(notif => {
      notif.style.top = parseInt(notif.style.top, 10) + notification.clientHeight + 2 + 'px';
    });

    setTimeout(() => {
        notification.style.top = `${paddingTop}px`; // 设置新增通知的位置
    }, 10); // 等待一小段时间后添加动画效果

    setTimeout(() => {
        notification.style.top = '-100px'; // 隐藏通知
        setTimeout(() => {
            notification.remove(); // 移除通知元素
            notifications = notifications.filter(notif => notif !== notification); // 从存储数组中删除消失的通知
        }, 500); // 等待动画完成后移除元素
    }, 3000); // 3秒后隐藏通知

    notifications.push(notification); // 将通知添加到存储数组中
    notificationIndex++;
}

  </script>
</body>

</html>